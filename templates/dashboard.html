<!-- templates/dashboard.html -->
{% extends "base.html" %}
{% block content %}
<h1 class="mb-4">Dashboard</h1>
<div class="row">
    <div class="col-md-4">
        <div class="card text-white bg-success mb-3">
            <div class="card-header">Total Income</div>
            <div class="card-body">
                <h5 class="card-title">${{ total_income }}</h5>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-danger mb-3">
            <div class="card-header">Total Expenses</div>
            <div class="card-body">
                <h5 class="card-title">${{ total_expense }}</h5>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-info mb-3">
            <div class="card-header">Balance</div>
            <div class="card-body">
                <h5 class="card-title">${{ balance }}</h5>
            </div>
        </div>
    </div>
</div>

<h2>Expenses by Category</h2>
<canvas id="expenseChart" width="400" height="200"></canvas>

<script>
    var ctx = document.getElementById('expenseChart').getContext('2d');
    var expenseData = {
        labels: {{ categories | tojson }},
        datasets: [{
            label: 'Expenses by Category',
            data: {{ amounts | tojson }},
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                // Add more colors as needed
            ],
            borderColor: [
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                // Add more colors as needed
            ],
            borderWidth: 1
        }]
    };
    var expenseChart = new Chart(ctx, {
        type: 'pie',
        data: expenseData,
    });
</script>

<hr>

<h2>Upcoming Recurring Transactions</h2>
<div id='calendar'></div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            height: 650,
            events: {{ calendar_events | tojson }},
            eventDidMount: function(info) {
                // Optional: Add tooltip or other enhancements
                var tooltip = new bootstrap.Tooltip(info.el, {
                    title: info.event.extendedProps.category,
                    placement: 'top',
                    trigger: 'hover',
                    container: 'body'
                });
            }
        });

        calendar.render();
    });
</script>

<h2 class="mt-5">Recent Transactions</h2>
<!-- Existing recent transactions table or content -->
<table class="table table-striped">
    <thead>
        <tr>
            <th>Date</th>
            <th>Description</th>
            <th>Category</th>
            <th>Amount ($)</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for txn in recent_transactions %}
        <tr>
            <td>{{ txn.date.strftime('%Y-%m-%d') }}</td>
            <td>{{ txn.description }}</td>
            <td>{{ txn.category.name }}</td>
            <td>{{ "%.2f"|format(txn.amount) }}</td>
            <td>
                <a href="{{ url_for('edit_transaction', transaction_id=txn.id) }}" class="btn btn-sm btn-outline-primary"><i class="fas fa-edit"></i> Edit</a>
                <form action="{{ url_for('delete_transaction', transaction_id=txn.id) }}" method="POST" class="d-inline" onsubmit="return confirmDelete();">
                    <button type="submit" class="btn btn-sm btn-outline-danger"><i class="fas fa-trash-alt"></i> Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
